<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- Include Bootstrap JavaScript and jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<%- include('userSidePartials/UserHeader',{user}) %>
<style>
    @import url('https://fonts.googleapis.com/css?family=Montserrat:300,400');

body {
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome and Opera */
}


#wallet .container {
  display: flex;
  justify-content: center;
}

#wallet .iphone {
    background-color: #F7F7F7;
  margin: 10px;
  height: 1000px; /* You can adjust this height as needed */
  width: 1500px; /* You can adjust this width as needed */
  box-shadow: 0 1px 5px -1px rgba(0, 0, 0, 0.3), inset 0 0 0 1px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  position: relative;
  transform: scale(1); /* Reset the scale to 1 for desktop size */
  transform-origin: top center;
}

#wallet .header {
  height: 30%;
  background-color: #44B0A0;
  border-bottom-right-radius: 40px;
    border-bottom-left-radius: 40px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  position: relative;
  z-index: 1;
   overflow: hidden;
}

#wallet .header::before{
  content:"";
  height: 200px;
  width: 200px;
  background-color: #53b5a8;
  border-radius: 50%;
  position:absolute;
  top: -60px;
  left: -100px;
  z-index: 2;
}

#wallet .header::after {
  content:"";
  height: 100px;
  width: 100px;
  background-color: #53b5a8;
  border-radius: 50%;
  position:absolute;
  right: -20px;
  bottom: -30px;
  z-index: 2;
 
}

#wallet .header-summary {
  display: flex;
  flex-direction: column;
font-family: 'Montserrat', sans-serif;
  color: white;
  z-index: 3;
}

#wallet .summary-text {
  font-size: 1.2rem;
  font-weight: 300;
  margin-bottom: 1.5rem;
}

#wallet .summary-balance {
  font-size: 2rem;
  letter-spacing: 1.5px;
  margin-bottom: 0.8rem;
  
}

#wallet .summary-text-2 {
  font-size: 0.8rem;
  letter-spacing: 1px;
}

#wallet .user-profile {
  margin-top: 4rem;
  height: 70px;
  width: 70px;
  align-self: flex-start;
}

#wallet .user-photo {
  height: 100%;
  width: 100%;
  border-radius: 50%;
  border: 1px solid white;
  box-shadow: 5px 5px 25px 0px rgba(0,0,0,0.2);
}

#wallet .content {
  z-index: 4;
  position: absolute;
  top: 210px;
  margin-left:30px;
  display:flex;
  flex-direction:column;
  width:85%;
}

#wallet .card {
  
font-family: 'Montserrat', sans-serif;
  align-self: stretch;
  background-color: white;
  border-radius: 12px;
  display: flex;
  flex-direction:column;
   box-shadow: 0 14px 28px rgba(0,0,0,0.02), 0 10px 10px rgba(0,0,0,0.0);
}

#wallet .upper-row {
  display: flex;
  justify-content: space-evenly;
  padding-bottom: 25px;
  padding-top: 10px
}

#wallet .card-item {
  margin: 20px;
  display: flex;
  flex-direction: column;
}

#wallet .card-item span:first-child {
  font-size: 0.7rem;
  font-weight: bold;
  margin-bottom:10px;
}

#wallet .card-item span:last-child {
  font-size: 1.2rem;
  font-weight: 300;
}

#wallet .dollar {
  color: #FFC168;
}

#wallet .lower-row {
  display: flex;
  justify-content: space-evenly;
  margin-bottom: 20px;
}

#wallet .lower-row::before {
    content: '';
    display: block;
    position: absolute;
    top: 110px;
    width: 50%;
    left: 25%;
    border-top: 1px solid #E1E1E1;
}

#wallet .icon-item {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#wallet .icon {
  color: #FFC168;
  padding: 10px;
  background-color: #FBFBFB;
  border-radius: 5px;
  margin-bottom: 5px;
}

#wallet .icon-text {
  font-size: 0.6em;
  color: #939393;
}

#wallet .transactions {
  font-family: 'Montserrat', sans-serif;
  display: flex;
  position: relative;
  margin-top: 1.5rem;
  flex-direction: column;
}

#wallet .t-desc {
  font-size: 0.8rem;
  font-weight: bold;
  padding-bottom: 10px;
}

#wallet .transaction {
  cursor: default;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color:white;
  box-shadow: 0 14px 28px rgba(0,0,0,0.02), 0 10px 10px rgba(0,0,0,0.0);
  border-radius: 12px;
  margin-bottom:20px;
}

#wallet .t-details {
  width: 55%;
}

#wallet .t-icon-container {
  width: 45px;
  align-self: flex-start;
}

#wallet .t-icon {
  width: 100%;
  border-radius: 50%;
  box-shadow: 5px 5px 25px 0px rgba(0,0,0,0.2);
}

#wallet .t-title {
  text-align: left;
  flex-grow: 1;
  font-size: 0.8rem;
  font-weight: bold;
  margin-bottom: 5px;
}

#wallet .t-time {
  font-size: 0.6rem;
  opacity: 0.6;
  font-weight: 300;
  letter-spacing: 1px;
}

#wallet .t-amount {
  font-size: 0.6rem;
  letter-spacing: 1px;
  font-weight: 400;
  color: #06D778;
}

#wallet .red {
  color: #F4532D;
}

#wallet .drawer {
  display:flex;
  background-color: white;
  height:80px;
  position:absolute;
  bottom: 0px;
  width: 100%;
  border-top-left-radius: 50px;
  border-top-right-radius: 50px;
  z-index: 5;
  justify-content: space-evenly;
  align-items: center;
}


#wallet .drawer span {
  display: inline-block;
  font-size: 1.5rem;
  color: #FFC168;
  transition: all 0.4s;
  cursor: pointer;
}

#wallet .drawer span i:hover {
  transform: scale(1.2);
  border-bottom: 2px solid orange;
}

#wallet .drawer span i {
  transition: all 0.3s ease;
  padding-bottom: 8px;
}



#wallet .menu-btn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 50px;
  height: 50px;
  background-color: #FFC168;
  color: white;
  top: -25px;
  position: absolute;
  transform: rotate(-45deg);
  border-radius: 10px;
  box-shadow: 5px 5px 25px 0px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: all 0.1s;
  opacity: 0.9;
}

#wallet .menu-btn:hover {
  box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
}

#wallet .menu-btn i{
  font-size: 1.5em;
  transform: rotate(45deg);
  
}

#wallet .footer {
  margin-top: 20px;
  text-align: center;
}

#wallet .transaction:hover {
    box-shadow: 0 1px 5px -1px rgba(0, 0, 0, 0.3), inset 0 0 0 1px rgba(0, 0, 0, 0.15);
}
#wallet .add-money-button {
            text-align: center;
            margin-top: 20px;
        }

        #wallet .add-money-button button {
            padding: 10px 20px;
            background-color: #FFC168;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 20px;
        }

        #wallet .add-money-button button:hover {
            background-color: #F4532D;
        }
        .custom-button {
    padding: 10px 20px;
    background-color: #FFC168;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    margin-bottom: 20px;
   
    max-width: 100px;
}

.custom-button:hover {
    background-color: #F4532D;
}
</style>
<%- include('userSidePartials/UserMobileHeader') %>

<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Pages
                <span></span> Account
            </div>
        </div>
    </div>
    <section class="pt-150 pb-150">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 m-auto">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="dashboard-menu">
                                <ul class="nav flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                            href="#dashboard" role="tab" aria-controls="dashboard"
                                            aria-selected="false"><i
                                                class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="Edit-Profile-tab" data-bs-toggle="tab"
                                            href="#Edit-Profile" role="tab" aria-controls="Edit-Profile"
                                            aria-selected="true"><i class="fi-rs-user mr-10"></i>Edit Account</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                            role="tab" aria-controls="orders" aria-selected="false"><i
                                                class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="wallet-tab" data-bs-toggle="tab" href="#wallet" role="tab" aria-controls="wallet" aria-selected="true"><i class="fi-rs-user mr-10"></i>Wallet</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/referral"><i class="fa-solid fa-money-bill-transfer fa-lg"></i></i>  Referral</a>
                                    </li>
                                    <!-- <li class="nav-item">
                                        <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order</a>
                                    </li> -->
                                    <li class="nav-item">
                                        <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                            role="tab" aria-controls="address" aria-selected="true"><i
                                                class="fi-rs-marker mr-10"></i>My Address</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/logout"><i
                                                class="fi-rs-sign-out mr-10"></i>Logout</a>
                                    </li>
                                </ul>
                            </div>
                        </div>



                        <div class="col-md-8">
                            <div class="tab-content dashboard-content">


                                <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                    aria-labelledby="dashboard-tab">
                                    <div class="card">

                                        <div class="rounded-top text-white d-flex flex-row"
                                            style="background-color: rgb(7, 128, 118); height:150px;">
                                            <div class="ms-3" style="margin-top: 130px;">
                                                <h5 style="color: white;"><%= userDetails.name %></h5>
                                            </div>
                                        </div>
                                        <div class="p-4 text-black" style="background-color: #f8f9fa;">
                                            <div class="justify-content-center text-center py-1"
                                                style="margin-top: 50px;">

                                                <h4>Profile Details</h4>

                                                <div class="d-flex justify-content-center ">

                                                    <div class="table-responsive w-100 border-0 bg-transparent"
                                                        style="border: none;">
                                                        <table class="table mb-0 border-0 text-md-center"
                                                            style="border: none;">

                                                            <tbody>
                                                                <tr>
                                                                    <td>Name </td>
                                                                    <td><%= userDetails.name %></td>
                                                                </tr>
            
                                                                <tr>
                                                                    <td>Email </td>
                                                                    <td><%= userDetails.email %></td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Gender </td>
                                                                    <td><%= userDetails.gender %></td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Mobile </td>
                                                                    <td><%= userDetails.mobile %></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>


                                                </div>

                                                <!-- //Change password / -->
                                                <div class="row mt-4 w-75 mx-auto ">
                                                    <button type="button" id="changePasswordbtn" class="btn">Change
                                                        Password</button>
                                                </div>

                                            </div>
                                        </div>


                                    </div>
                                </div>


                                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                    <div class="row">
                                        <div class="col">
                                            <% if (orderDetails && orderDetails.length > 0) { %>
                                            <% orderDetails.forEach((order) => { %>
                                            <br>
                                            <div class="card card-2">
                                                <div class="card-body">
                                                    <div class="media">
                                                        <div class="media-body my-auto text-right">
                                                            <div class="row my-auto flex-column flex-md-row">
                                                                <div class="col my-auto">
                                                                    <h6 class="mb-0">OrderID:<%= order.oId %></h6>
                                                                </div>
                                                                <div class="col-auto my-auto">
                                                                    <small>Status: <%= order.status %></small>
                                                                </div>
                                                                <!-- <div class="col my-auto">
                                                                    <small>Size: M</small>
                                                                </div> -->
                                                                <div class="col my-auto">
                                                                    <small>Date: <%= order.orderDate.toLocaleString() %></small>
                                                                </div>
                                                                <div class="col my-auto">
                                                                    <small>Payment Method:
                                                                        <%= order.paymentMethod %></small>
                                                                </div>

                                                                <div class="col my-auto">
                                                                    <h6 class="mb-0"> Total: &#8377;<%= order.billTotal %></h6>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                    <hr class="my-3">
                                                    <% if(order.status==='Canceled'){ %>
                                                    <div class="row d-flex justify-content-start" id="cancellationMessage">
                                                        <span class="text-danger  d-flex justify-content-start w-25"><svg xmlns="http://www.w3.org/2000/svg"
                                                                width="24px" height="24px" viewBox="0 0 24 24">
                                                                <path fill="#282C3F" fill-rule="nonzero"
                                                                    d="M15.854 8.146a.495.495 0 0 0-.703 0L12 11.296l-3.15-3.15a.495.495 0 0 0-.704 0 .495.495 0 0 0 0 .703L11.297 12l-3.15 3.15a.5.5 0 1 0 .35.85.485.485 0 0 0 .349-.146l3.15-3.15 3.151 3.15a.5.5 0 0 0 .35.147.479.479 0 0 0 .35-.147.495.495 0 0 0 0-.703L12.702 12l3.15-3.15a.495.495 0 0 0 0-.704z">
                                                                </path>
                                                            </svg> Order has been canceled.</span>
                                                            <div class=" d-flex justify-content-end">
                                                                <a class="btn btn-small w-25 h-25" href="/order-details/<%= order._id %>">Order Details</a>
                                                            </div>
                                                 
                                                    


                                                    <% }else{ %>
                                                    <div class="row">
                                                        <% if(order.status!=="Delivered" && order.status!=="Return"){ %>  
                                                            <button type="button" class="btn btn-small w-25 h-25"
                                                            onclick="cancelOrder('<%= order._id %>')">cancel
                                                            order</button>
                                                        <% }else if(order.status ==='Return'&& order.requests[0].status=='Pending') {%>
                                                            <div class="col-lg-6 col-md-6  d-flex justify-content-start">
                                                                <p class="badge bg-danger">Return request sent</p>
                                                            </div>

                                                        <% }else{ %>
                                                            <% if(order.status!=='Delivered'){ %>
                                                                <div class="col-lg-6 col-md-6  d-flex justify-content-start">
                                                                    <p class="badge bg-success">Return processed.</p>
                                                                </div>
                                                            <% } %>
                                                           
                                                        <% } %>
                                                        <div class=" d-flex justify-content-end">
                                                            <a class="btn btn-small w-25 h-25" href="/order-details/<%= order._id %>">Order Details</a>
                                                        </div>
                                                 <% } %>
                                                </div>     
                                                  
                                                    <!-- Bootstrap Confirmation Modal -->
                                                    <div class="modal" id="confirmationModal" tabindex="-1"
                                                        aria-labelledby="confirmationModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header"
                                                                    <h5 class="modal-title" id="confirmationModalLabel">
                                                                        Confirm Order Cancellation</h5>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    Are you sure you want to cancel this order? Please
                                                                    provide a reason below (optional):
                                                                    <textarea id="cancellationReason"
                                                                        class="form-control" rows="3"></textarea>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Close</button>
                                                                    <button type="button" class="btn btn-danger"
                                                                        id="confirmCancellationButton">Confirm
                                                                        Cancellation</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    
                                                    
                                                </div>

                                            </div>
                                            

                                            <% }) %>
                                            <% }else{ %>
                                            <div class="row">
                                                <h4>No Orders Found Please continue Shopping</h4>
                                                <a href="/shop" type="button" class="btn">continue Shoping</a>
                                            </div>
                                            <% } %>
                                            <% if(totalorders>5){ %>
                                                <form action="/userorders" method="get">
                                                    <button type="submit" class="btn btn-primary mt-2">See more</button>
                                                  </form>
                                            <% } %>
                                            
                                        </div>
                                    </div>
                                </div>



                                <div class="tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                                    <div class="container">
                                        <div class="iphone">
                                            <div class="header">
                                                <div class="header-summary">
                                                    <div class="summary-text">
                                                        My Balance
                                                    </div>
                                                    <div class="summary-balance">
                                                        &#8377; <%= walletData.balance %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="content">
                                                <div class="transactions">
                                                    <div class="t-desc">Transaction History</div>
                                                    <% walletTransactions.slice(0, 5).forEach(transaction => { %>
                                                    <div class="transaction">
                                                        <div class="t-details">
                                                            <div class="t-title"><%= transaction.payment %></div>
                                                            <div class="t-time"><%= transaction.date.toLocaleString() %></div>
                                                        </div>
                                                        <% if (transaction.transactionType === "credit"){ %>
                                                            <div class="t-amount" style="color: #06D778;">+&nbsp;<%= transaction.amount %> <span class="dollar">&#8377;</span></div>
                                                        <%} else {%>
                                                            <div class="t-amount" style="color: red;">-&nbsp;<%= transaction.amount %> <span class="dollar">&#8377;</span></div>
                                                            <% } %>
                                                    </div>
                                                  <%  }); %>
                                                   <% if(walletTransactions.length>5) {%>
                                                  <button class="custom-button">See more</button>
                                                  <% } %>
                                                    <!-- Add more transaction entries here -->
                                                </div>
                                            </div>
                                            
                                        </div>
                                        
                                    </div>
                                </div>
                                

                                <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                    <!-- Button to trigger the modal -->
                                    <div class="row d-flex justify-content-end mb-4">
                                        <button class="btn btn-primary" id="openModalButton" data-toggle="modal"
                                            data-target="#addressModal">Add Address</button>
                                    </div>

                                    <!-- The modal -->
                                    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog"
                                        aria-labelledby="addressModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content modal-dialog-scrollable">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <!-- Your form content goes here -->
                                                    <form id="addressForm">
                                                        <!-- Form fields for address details -->
                                                        <div class="form-group mb-3">
                                                            <label for="addressType">Address Type</label>
                                                            <select class="form-control" id="addressType"
                                                                name="addressType">
                                                                <option value="home">Home</option>
                                                                <option value="work">Work</option>
                                                                <option value="temp">Temporary</option>
                                                            </select>
                                                            <span id="addressTypeError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="houseNo">House No</label>
                                                            <input type="text" class="form-control" id="houseNo"
                                                                placeholder="House Number">
                                                            <span id="houseNoError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="street">Street</label>
                                                            <input type="text" class="form-control" id="street"
                                                                placeholder="Street">
                                                            <span id="streetError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="landmark">Landmark</label>
                                                            <input type="text" class="form-control" id="landmark"
                                                                placeholder="Landmark">

                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="pincode">Pincode</label>
                                                            <input type="number" class="form-control" id="pincode"
                                                                placeholder="Pincode">
                                                            <span id="pincodeError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="city">City</label>
                                                            <input type="text" class="form-control" id="city"
                                                                placeholder="City">
                                                            <span id="cityError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="district">District</label>
                                                            <input type="text" class="form-control" id="district"
                                                                placeholder="district">
                                                            <span id="districtError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="state" class="mb-2 d-block">State</label>
                                                            <select id="state" class="form-control border" name="state">
                                                                <option value=""></option>
                                                                <!-- Your state options will be dynamically added here -->
                                                            </select>
                                                            <span id="stateError" class="text-danger"></span>

                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="country">Country</label>
                                                            <input type="text" class="form-control" id="country"
                                                                placeholder="Country">
                                                            <span id="countryError" class="text-danger"></span>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Close</button>

                                                    <button type="button" class="btn btn-primary"
                                                        id="saveAddress">Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <% if(addresses && addresses.addresses.length>0){ %>
                                        <% addresses.addresses.forEach((item,index)=>{ %>
                                        <div class="col-lg-12">
                                            <div class="card">
                                                <% if(item.addressType=== 'temp' ){ %>
                                                <div class="card-header">
                                                    <h5 class="mb-0">Temporary Address</h5>
                                                </div>
                                                <% }else{ %>
                                                <div class="card-header">
                                                    <h5 class="mb-0"><%= item.addressType.toUpperCase() %> Address</h5>
                                                </div>
                                                <% } %>
                                                <div class="card-body">
                                                    <address>
                                                        <%= item.HouseNo %> <%= item.Street %><br>
                                                        <%= item.city %>, <%= item.State %> <%= item.pincode %>
                                                        <%= item.Country %><br>

                                                    </address>
                                                    <p><%= item.district %></p>
                                                </div>
                                                <div class="card-footer d-flex  justify-content-between">
                                                    <button class="btn" data-toggle="modal"
                                                        data-target="#editAddressModal<%= index %>"
                                                        data-index="<%= index %>">Edit</button>
                                                    <button class="btn" type="button"
                                                        onclick="addressRemove('<%= item.addressType  %>')">Remove</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Modal for Editing Address -->
                                        <div class="modal" id="editAddressModal<%= index %>">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Edit Address</h5>
                                                        <button type="button" class="close"
                                                            data-dismiss="modal">&times;</button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="editaddressForm" action="/profile/editAddress"
                                                            method="post">
                                                            <!-- Form fields for address details -->
                                                            <div class="form-group mb-3">
                                                                <label for="addressType">Address Type</label>
                                                                <select class="form-control" id="editAddressType"
                                                                    value="<%= item.addressType %>" name="addressType"
                                                                    required>
                                                                    <option value="home"
                                                                        <% if (item.addressType === 'home') { %>selected<% } %>>
                                                                        Home</option>
                                                                    <option value="work"
                                                                        <% if (item.addressType === 'work') { %>selected<% } %>>
                                                                        Work</option>
                                                                    <option value="temp"
                                                                        <% if (item.addressType === 'temp') { %>selected<% } %>>
                                                                        Temporary</option>
                                                                </select>
                                                                <span id="addressTypeError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="houseNo">House No</label>
                                                                <input type="text" class="form-control" id="editHouseNo"
                                                                    required name="HouseNo" value="<%= item.HouseNo %>"
                                                                    placeholder="House Number">
                                                                <span id="edithouseNoError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="street">Street</label>
                                                                <input type="text" class="form-control" id="editStreet"
                                                                    required name="Street" value="<%= item.Street %>"
                                                                    placeholder="Street">
                                                                <span id="editstreetError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="landmark">Landmark</label>
                                                                <input type="text" class="form-control" id="landmark"
                                                                    name="Landmark" placeholder="Landmark">

                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="pincode">Pincode</label>
                                                                <input type="number" class="form-control" id="pincode"
                                                                    required name="pincode" value="<%= item.pincode %>"
                                                                    placeholder="Pincode">
                                                                <span id="editpincodeError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="city">City</label>
                                                                <input type="text" class="form-control" id="city"
                                                                    name="city" required value="<%= item.city %>"
                                                                    placeholder="City">
                                                                <span id="editcityError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="district">District</label>
                                                                <input type="text" class="form-control" id="district"
                                                                    required value="<%= item.district %>"
                                                                    name="district" placeholder="district">
                                                                <span id="editdistrictError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="state" class="mb-2 d-block">State</label>
                                                                <select id="state" class="form-control border" required
                                                                    name="state">
                                                                    <option value="">Select A State</option>
                                                                    <option value="Andhra Pradesh"
                                                                        <% if (item.State === 'Andhra Pradesh') { %>selected<% } %>>
                                                                        Andhra Pradesh</option>
                                                                    <option value="Arunachal Pradesh"
                                                                        <% if (item.State === 'Arunachal Pradesh') { %>selected<% } %>>
                                                                        Arunachal Pradesh</option>
                                                                    <option value="Assam"
                                                                        <% if (item.State === 'Assam') { %>selected<% } %>>
                                                                        Assam</option>
                                                                    <option value="Bihar"
                                                                        <% if (item.State === 'Bihar') { %>selected<% } %>>
                                                                        Bihar</option>
                                                                    <option value="Chhattisgarh"
                                                                        <% if (item.State === 'Chhattisgarh') { %>selected<% } %>>
                                                                        Chhattisgarh</option>
                                                                    <option value="Goa"
                                                                        <% if (item.State === 'Goa') { %>selected<% } %>>
                                                                        Goa</option>
                                                                    <option value="Gujarat"
                                                                        <% if (item.State === 'Gujarat') { %>selected<% } %>>
                                                                        Gujarat</option>
                                                                    <option value="Haryana"
                                                                        <% if (item.State === 'Haryana') { %>selected<% } %>>
                                                                        Haryana</option>
                                                                    <option value="Himachal Pradesh"
                                                                        <% if (item.State === 'Himachal Pradesh') { %>selected<% } %>>
                                                                        Himachal Pradesh</option>
                                                                    <option value="Jharkhand"
                                                                        <% if (item.State === 'Jharkhand') { %>selected<% } %>>
                                                                        Jharkhand</option>
                                                                    <option value="Karnataka"
                                                                        <% if (item.State === 'Karnataka') { %>selected<% } %>>
                                                                        Karnataka</option>
                                                                    <option value="Kerala"
                                                                        <% if (item.State === 'Kerala') { %>selected<% } %>>
                                                                        Kerala</option>
                                                                    <option value="Madhya Pradesh"
                                                                        <% if (item.State === 'Madhya Pradesh') { %>selected<% } %>>
                                                                        Madhya Pradesh</option>
                                                                    <option value="Maharashtra"
                                                                        <% if (item.State === 'Maharashtra') { %>selected<% } %>>
                                                                        Maharashtra</option>
                                                                    <option value="Manipur"
                                                                        <% if (item.State === 'Manipur') { %>selected<% } %>>
                                                                        Manipur</option>
                                                                    <option value="Meghalaya"
                                                                        <% if (item.State === 'Meghalaya') { %>selected<% } %>>
                                                                        Meghalaya</option>
                                                                    <option value="Mizoram"
                                                                        <% if (item.State === 'Mizoram') { %>selected<% } %>>
                                                                        Mizoram</option>
                                                                    <option value="Nagaland"
                                                                        <% if (item.State === 'Nagaland') { %>selected<% } %>>
                                                                        Nagaland</option>
                                                                    <option value="Odisha"
                                                                        <% if (item.State === 'Odisha') { %>selected<% } %>>
                                                                        Odisha</option>
                                                                    <option value="Punjab"
                                                                        <% if (item.State === 'Punjab') { %>selected<% } %>>
                                                                        Punjab</option>
                                                                    <option value="Rajasthan"
                                                                        <% if (item.State === 'Rajasthan') { %>selected<% } %>>
                                                                        Rajasthan</option>
                                                                    <option value="Sikkim"
                                                                        <% if (item.State === 'Sikkim') { %>selected<% } %>>
                                                                        Sikkim</option>
                                                                    <option value="Tamil Nadu"
                                                                        <% if (item.State === 'Tamil Nadu') { %>selected<% } %>>
                                                                        Tamil Nadu</option>
                                                                    <option value="Telangana"
                                                                        <% if (item.State === 'Telangana') { %>selected<% } %>>
                                                                        Telangana</option>
                                                                    <option value="Tripura"
                                                                        <% if (item.State === 'Tripura') { %>selected<% } %>>
                                                                        Tripura</option>
                                                                    <option value="Uttar Pradesh"
                                                                        <% if (item.State === 'Uttar Pradesh') { %>selected<% } %>>
                                                                        Uttar Pradesh</option>
                                                                    <option value="Uttarakhand"
                                                                        <% if (item.State === 'Uttarakhand') { %>selected<% } %>>
                                                                        Uttarakhand</option>
                                                                    <option value="West Bengal"
                                                                        <% if (item.State === 'West Bengal') { %>selected<% } %>>
                                                                        West Bengal</option>
                                                                    <!-- Add more states as needed -->
                                                                </select>
                                                                <span id="editstateError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="country">Country</label>
                                                                <input type="text" required class="form-control"
                                                                    id="country" value="<%= item.Country %>"
                                                                    name="Country" placeholder="Country">
                                                                <span id="editcountryError" class="text-danger"></span>
                                                            </div>
                                                            <!-- Other address fields here... -->

                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-primary">Save</button>
                                                        <button type="button" class="btn btn-secondary"
                                                            data-dismiss="modal">Close</button>
                                                    </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                        <% }else{ %>
                                        <div class="col-lg-12">
                                            <h5>Not Address Found</h5>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>

                                <!-- Edit Profile -->
                                <div class="tab-pane fade" id="Edit-Profile" role="tabpanel"
                                    aria-labelledby="Edit-Profile-tab">
                                    <div class="card border-0">
                                        <div class="card-header bg-transparent text-center">
                                            <h5 class="mb-0">Edit Account</h5>
                                        </div>
                                        <form id="editprofile">
                                            <!-- 2 column grid layout with text inputs for the first and last names -->
                                            <div class="row mb-4">
                                                <div class="col">
                                                    <div class="form-outline">
                                                        <label class="form-label" for="form6Example1">Username</label>
                                                        <input type="text" id="form6Example1"
                                                            value="<%= userDetails.name  %>" name="firstName"
                                                            required class="form-control" />

                                                    </div>
                                                    <span id="firstNameError" class="error-message"></span>
                                                </div>
                                            </div>


                                            <!-- Email input -->
                                            <div class="form-outline mb-4">
                                                <label class="form-label" for="form6Example5">Email</label>
                                                <input type="email" id="form6Example5" value="<%= userDetails.email  %>"
                                                    name="email" required class="form-control" />
                                                <span id="emailError" class="error-message text-danger"></span>
                                            </div>



                                            <div class="form-outline ">
                                                <label class="form-label" for="form6Example9">Gender</label>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender" id="male"
                                                        value="male"
                                                        <%= userDetails.gender === "male" ? "checked" : "" %> />
                                                    <label class="form-check-label" for="male">Male</label>
                                                </div>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender"
                                                        id="female" value="female"
                                                        <%= userDetails.gender === "female" ? "checked" : "" %> />
                                                    <label class="form-check-label" for="female">Female</label>
                                                </div>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender"
                                                        id="others" value="others"
                                                        <%= userDetails.gender === "others" ? "checked" : "" %> />
                                                    <label class="form-check-label" for="others">Others</label>
                                                </div>
                                            </div>



                                            <!-- Number input -->
                                            <div class="form-outline mb-4">
                                                <label class="form-label" for="form6Example6">Phone</label>
                                                <input type="number" id="form6Example6"
                                                    value="<%= userDetails.mobile  %>" name="mobile" required
                                                    class="form-control" />
                                                <span id="mobileError" class="error-message text-danger"></span>
                                            </div>
                                            <button id="openModal" type="submit"
                                                class="btn btn-primary btn-block mb-4">Save Changes</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- //Modals -->

<!-- User Contact Details Modal -->
<div class="modal fade" id="userContactModal" tabindex="-1" aria-labelledby="userContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userContactModalLabel">User Contact Details</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Email: <%= userDetails.email %></p>
                <!-- Button to request OTP -->
                <button id="requestOTPButton" class="btn btn-primary">Request OTP</button>
            </div>
        </div>
    </div>
</div>

<!-- OTP Verification Modal -->
<div class="modal fade" id="otpVerificationModal" tabindex="-1" aria-labelledby="otpVerificationModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="otpVerificationModalLabel">OTP Verification</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Enter the OTP received on your email:</p>
                <input type="text" id="otpInput" class="form-control">
                <button id="verifyOTPButton" class="btn btn-primary mt-3">Verify OTP</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
        // An array of Indian states
        var indianStates = ["Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa",
            "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh",
            "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan",
            "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"
        ];

        // Populate the select box with the list of states
        $('#state').select2({
            data: indianStates.map(function (state) {
                return {
                    id: state,
                    text: state
                };
            }),
            placeholder: 'Select a state',
            allowClear: true
        });





        document.getElementById('saveAddress').addEventListener('click', function () {
            // Validate and save the address
            if (validateForm()) {
                saveAddress();
            }
        });

        function validateForm() {
            var valid = true;
            var addressType = $('#addressType').val();
            var houseNo = $('#houseNo').val().trim();
            var street = $('#street').val().trim();
            var pincode = $('#pincode').val().trim();
            var city = $('#city').val().trim();

            var district = $('#district').val().trim();
            var state = $('#state').val();
            var country = $('#country').val().trim();
            // Clear previous errors
            clearErrors();

            // Validation rules
            if (!addressType) {
                valid = false;
                $('#addressTypeError').text('Type of Address is required')
            }
            if (!houseNo) {
                valid = false;
                $('#houseNoError').text('House No is required.');
            }
            if (!street) {
                valid = false;
                $('#streetError').text('Street is required.');
            }
            if (!pincode || pincode.length !== 6 || isNaN(pincode)) {
                valid = false;
                $('#pincodeError').text('Pincode must be a 6-digit number.');
            }
            if (!city|| !/^[A-Za-z\s]+$/.test(city)) {
                valid = false;
                $('#cityError').text('City is required.');
            }
            if (!district) {
                valid = false;
                $('#districtError').text('District is Required')
            }
            if (!state) {
                valid = false;
                $('#stateError').text('State is required.');
            }
            if (!country|| /\d/.test(country)) {
                valid = false;
                $('#countryError').text('Country is required.');
            }

            return valid;
        }

        function clearErrors() {
            $('#addressTypeError').text();
            $('#houseNoError').text('');
            $('#streetError').text('');
            $('#pincodeError').text('');
            $('#cityError').text('');
            $('#districtError').text('')
            $('#stateError').text('');
            $('#countryError').text('');
        }


        function saveAddress() {
            var addressData = {
                addressType: $('#addressType').val(),
                houseNo: $('#houseNo').val(),
                street: $('#street').val(),
                landmark: $('#landmark').val(),
                pincode: $('#pincode').val(),
                city: $('#city').val(),
                district: $('#district').val(),
                state: $('#state').val(),
                country: $('#country').val()
            };
            fetch('/profile/addAddress', {
                    method: 'POST',
                    body: JSON.stringify(addressData),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    if (data.message) {
                        Swal.fire('Success', 'Address Saved Successfully', 'success')
                        $('#addressModal').modal('hide');
                        window.location.reload()
                    } else {
                        alert('Failed to save address. Please try again.');
                    }
                })
                .catch(function (error) {
                    console.error(error);
                    //  Swal.fire('Error', 'An error occurred while saving the address.', 'error');
                });
        }
    });



    //Edit ADdress
    function addressRemove(addressType) {
        // You can use AJAX (e.g., fetch or XMLHttpRequest) to send a DELETE request to the backend
        Swal.fire({
        title: 'Are you sure?',
        text: 'You won\'t be able to revert this!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'No, cancel!',
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/profile/deleteAddress?addressType=${addressType}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then((response) => {
                if (response.ok) {
                    // Address was successfully deleted
                    // Display a success message
                    Swal.fire('Success', 'Address Deleted Successfully', 'success').then(() => {
                        // Reload the page after the user confirms the success message
                        window.location.reload();
                    });
                } else {
                    // Handle the error and display an error message
                    console.error('Error deleting address:', response.statusText);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
    });
    }


    const form = document.querySelector('#editprofile');
    const firstNameInput = document.getElementById('form6Example1');
    // const lastNameInput = document.getElementById('form6Example2');
    const emailInput = document.getElementById('form6Example5');
    const mobileInput = document.getElementById('form6Example6');

    form.addEventListener('submit', (event) => {
        event.preventDefault();
        let isValid = true;

        // Reset previous error messages
        document.querySelectorAll('.error-message').forEach((error) => {
            error.textContent = '';
        });

        // Validate first name and last name (not null)
        if (firstNameInput.value.trim() === '') {
            document.getElementById('firstNameError').textContent = 'First name is required.';
            isValid = false;
        }
        // if (lastNameInput.value.trim() === '') {
        //     document.getElementById('lastNameError').textContent = 'Last name is required.';
        //     isValid = false;
        // }

        // Validate email format
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        if (!emailPattern.test(emailInput.value)) {
            document.getElementById('emailError').textContent = 'Invalid email format.';
            isValid = false;
        }

        // Validate mobile number (10 digits)
        if (mobileInput.value.length !== 10) {
            document.getElementById('mobileError').textContent = 'Mobile number must be 10 digits.';
            isValid = false;
        }

        if (isValid) {
            const firstName = document.getElementById('form6Example1').value;
                    // const lastName = document.getElementById('form6Example2').value;
                    const email = document.getElementById('form6Example5').value;
                    const gender = document.querySelector('input[name="gender"]:checked').value;
                    const mobile = document.getElementById('form6Example6').value;

                    // Now you have the values in the variables firstName, lastName, email, gender, and mobile.

            const formData ={
                firstName,
                email,
                gender,
                mobile
            }

            // Submit the form data using fetch
            fetch('/profile/editProfile', {
                method: 'POST',
                headers: {
                        'Content-Type': 'application/json' // Set the Content-Type header to JSON
                         },
                 body: JSON.stringify(formData)
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        // Handle success with Swal
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'Profile Updated successfully',
                        });
                    } else {
                        // Handle errors with Swal
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: `Error: ${data.message}`,
                        });
                    }
                })
                .catch((error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: `Fetch error: ${error}`,
                    });
                });
        }
    });


    document.querySelector('#changePasswordbtn').addEventListener('click', () => {
        // Make a fetch request to the '/change password' route
        alert("change")
        fetch('/profile/change-password', {
                method: 'GET', // You can adjust the HTTP method as needed
            })
            .then(response => {
                if (response.ok) {
                    // Handle success with a success toast message
                    toastr.success('Password Reset link sent successfully', 'Success');
                } else {
                    // Handle errors with an error toast message
                    toastr.error('Error changing password', 'Error');
                }
            })
            .catch(error => {
                // Handle fetch errors with an error toast message
                toastr.error('Fetch error', 'Error');
            });
    });



    function cancelOrder(orderId) {
        // Open the confirmation modal
        const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
        confirmationModal.show();

        // Handle the "Confirm Cancellation" button click
        const confirmCancellationButton = document.getElementById('confirmCancellationButton');
        confirmCancellationButton.addEventListener('click', function () {
            const cancellationReason = document.getElementById('cancellationReason').value;
            // Send an AJAX request to the server to cancel the order with the reason
            fetch(`/cancel-order/${orderId}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        reason: cancellationReason
                    }),
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then((response) => response.json())
                .then((result) => {
                    if (result.success) {
                        // Handle success, e.g., display a success message or update the UI
                        Swal.fire('Success', 'Order has been canceled successfully', 'success');
                        window.location.href = '/profile#orders'; 
                        location.reload();// Reload the page or refresh the order list
                    } else {
                        // Handle the case when the cancellation fails
                        alert('Order cancellation failed. Please try again.');
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again later.');
                });

            // Close the modal
            confirmationModal.hide();
        });
    }

    const seeMoreBtn = document.getElementById('seeMoreBtn');
let displayedTransactions = 5; // Initial number of transactions displayed

seeMoreBtn.addEventListener('click', () => {
    // Show additional transactions when the button is clicked
    displayedTransactions += 5; // Increment the count to display more entries
    renderTransactions(displayedTransactions); // Function to render transactions
});

function renderTransactions(displayCount) {
    // Update the displayed transactions based on displayCount
    const transactionsContainer = document.querySelector('.transactions');
    transactionsContainer.innerHTML = ''; // Clear existing entries
    
    walletTransactions.transactions.slice(0, displayCount).forEach(transaction => {
        // Render each transaction entry here
        transactionsContainer.innerHTML += `
            <div class="transaction">
                <!-- Transaction details -->
            </div>
        `;
    });
}

</script>


<%- include('userSidePartials/UserFooter') %>